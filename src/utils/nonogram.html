<html>
<head>
    <title>nono-gram</title>

    <style>
        td {
            margin : 0px;
            padding : 0px;
            border : 1px solid black;
            vertical-align : bottom;
            text-align: center;
        }
        td > input[type=button] {
            width : 30px;
            height : 30px;
            border : none;
            background-color: white;
            font-weight : bold;;
            color : red;
        }
    
    </style>
</head>
<body>
    <script>
        var SIZE = 10;
        var table_state = [];
        var h_condition = [[1], [1], [2], [2, 4], [4, 4], [4, 3], [3, 3], [3, 2, 1], [3, 3], [3, 4]];
        var w_condition = [[6], [7], [7], [2], [2, 1], [2], [2, 3], [8], [5], [5]];

        function root() {
            table_state  = initialArray(SIZE);// (테이블)버튼의 상태 쵝화
            noBaseControl();
        }
        
        function initialArray(SIZE) {
            var h = SIZE, w = SIZE;
            var arr = new Array();

            for(h = 0 ; h < SIZE ; h++) {
                temp = new Array();
                for(w = 0 ; w < SIZE ; w++) {
                    temp.push(0);
                }
                arr.push(temp);
            }
            return arr;
        }

        function insertCondition(h, w) {
            var str = "";
            var i = 0;

            if(h == 0 && w == 0) {
                str += "<td></td>";
                return str;
            } else if(h == 0) {// 가로 열에 숫자 조건을 달아주기 위함
                str += "<td>";
                for(i = 0 ; i < h_condition[w - 1].length ; i++) {
                    str += h_condition[w - 1][i];
                    str += "<br>";
                }
                str += "</td>";
                return str;
            } else if(w == 0) {// 세로 행에 숫자 조건을 달아주기 위함
                str += "<td>";
                for(i = 0 ; i < w_condition[h - 1].length ; i++) {
                    str += w_condition[h - 1][i];
                    str += " ";
                }
                str += "</td>";
                return str;
            }
            return "";
        }

        function makeGameTable() {
            var h = 0, w = 0;
            var str = "", temp_str = "";
    
            str += "<table>";
            for(h = 0 ; h < SIZE + 1 ; h++) {
                str += "<tr>";
                for(w = 0 ; w < SIZE + 1 ; w++) {
                    // 숫자 조건이 들어갈 차례면 숫자를 넣고 continue 한다.
                    temp_str = insertCondition(h, w);
                    if(temp_str.length != 0) {// 만족하면
                        str += temp_str;
                        continue;
                    }

                    // 숫자 조건이 아닐경우 버튼을 넣는다.
                    str += "<td>";
                    str += "<input type=\"button\" id=\"h" + h + "w" + w + "\"";
                    str += "onclick=\"changeState(" + h + "," +  w +")\">";
                    str += "</td>";
                }
                str += "</tr>";
            }
            str += "</table>";
    
            document.getElementById("game_table").innerHTML = str;
        }
    
        function changeState(h, w) {
            button_parse = document.getElementById("h" + h + "w" + w);
    
            if(button_parse.style.backgroundColor == "" && button_parse.value == "") {// 왜 white가 안되는지 모르겠음...
                button_parse.style.backgroundColor = "black";
                table_state[h - 1][w - 1] = 1;//게임 테이블과 상태의 불일치를 위해 처리
            } else if(button_parse.style.backgroundColor == "black") {
                button_parse.style.backgroundColor = "";
                button_parse.value = "X";
                table_state[h - 1][w - 1] = 2;//게임 테이블과 상태의 불일치를 위해 처리
            } else {
                button_parse.style.backgroundColor = "";
                button_parse.value = "";
                table_state[h - 1][w - 1] = 0;//게임 테이블과 상태의 불일치를 위해 처리
            }
        }

        function noBaseControl() {
            noBaseFunc1();
            noBaseFunc2();
        }

        function sumAll(arr) {
            return arr.reduce((a, b) => a + b) + arr.length - 1;
        }

        // 원소 + 공백의 크기의 합 == SIZE
        // 이면 한줄 완전 만족
        function noBaseFunc1() {
            var i = 0, j = 0, sum = 0;
            
            console.log("===== 조건 1(sumAll == SIZE) =====");
            
            // 가로 체크
            for(i = 0 ; i < w_condition.length ; i++) {
                if(SIZE == sumAll(w_condition[i])) {
                    console.log("조건1. 가로줄 " + (i + 1) + "번째 줄에서 만족.");
                }
            }
            // 세로 체크
            for(i = 0 ; i < h_condition.length ; i++) {
                if(SIZE == sumAll(h_condition[i])) {
                    console.log("조건1. 가로줄 " + (i + 1) + "번째 줄에서 만족.");
                }
            }
        }
        
        // SIZE - 원소 + 공백의 크기의 합
        // 각 원소에서 위 값을 뺀다
        // 완전 만족 X
        function noBaseFunc2() {
            var i = 0, j = 0, remain = 0, confirm_value = 0, weight = 0;
            var save_confirm_value = [];

            console.log("===== 조건 2(SIZE - sumAll) =====");

            //가로 체크
            for(i = 0 ; i < w_condition.length ; i++) {
                remain = SIZE - sumAll(w_condition[i]);// 각 원소에 뺄 값을 구한다.
                for(j = 0 ; j < w_condition[i].length ; j++) {
                    confirm_value = w_condition[i][j] - remain;// 원소에 remain을 뺏을 때의 값만큼 확정
                    //save_confirm_value.push(confirm_value);
                    if(confirm_value > 0) {
                        //weight = sumAll(save_confirm_value) * 2 - 1 + 1;
                        changeStateRange4w(i + 1, remain + 1, w_condition[i][j] + 1);// 화면에 보이는 바에 따르면 0, 0이 아니라 1, 1이다.
                        console.log("조건2. 가로줄 " + (i + 1) + "번째 줄에서 만족.");
                    }
                }
            }
            // 세로 체크
            // for(i = 0 ; i < h_condition.length ; i++) {
            //     weight = 0;// 가중치 초기화
            //     remain = SIZE - sumAll(h_condition[i]);// 각 원소에 뺄 값을 구한다.
            //     for(j = 0 ; j < h_condition[i].length ; j++) {
            //         confirm_value = h_condition[i][j] - remain;// 원소에 remain을 뺏을 때의 값만큼 확정
            //         save_confirm_value.push(confirm_value);
            //         if(confirm_value > 0) {
            //             changeStateRange4h(i + 1, remain + 1 + weight, h_condition[i][j] + weight + 1);// 화면에 보이는 바에 따르면 0, 0이 아니라 1, 1이다.
            //             console.log("조건2. 세로줄 " + (i + 1) + "번째 줄에서 만족.");
            //         }
            //         weight += h_condition[i][j] * 2 - 1 - 1;// 다음 조건을 위해 가중치
            //         if(confirm_value <= 0) {
            //             weight += 1;
            //         }
            //     }
            // }
        }
            
        // 세로 체크
            for(i = 0 ; i < h_condition.length ; i++) {
                remain = SIZE - sumAll(h_condition[i]);// 각 원소에 뺄 값을 구한다.
                for(j = 0 ; j < h_condition[i].length ; j++) {
                    confirm_value = h_condition[i][j] - remain;// 원소에 remain을 뺏을 때의 값만큼 확정
                    if(confirm_value > 0) {
                        changeStateRange4h(i + 1, remain + 1, h_condition[i][j] + 1);// 화면에 보이는 바에 따르면 0, 0이 아니라 1, 1이다.
                        console.log("조건2. 세로줄 " + (i + 1) + "번째 줄에서 만족.");
                        break;// 일단 하나만!
                    }
                }
            }

        // 범위로 지정해서 바꿔줌
        // 열 index, 시작 index, 끝 index
        function changeStateRange4w(w, start, finish) {
            var i = 0;

            for(i = start ; i < finish ; i++) {
                if(table_state[w-1][i-1] != 1) {//게임 테이블과 상태의 불일치를 위해 처리
                    changeState(w, i);
                }
            }
        }
        // 범위로 지정해서 바꿔줌
        // 행 index, 시작 index, 끝 index
        function changeStateRange4h(h, start, finish) {//게임 테이블과 상태의 불일치를 위해 처리
            var i = 0;

            for(i = start ; i < finish ; i++) {
                if(table_state[i-1][h-1] != 1) {
                    changeState(i, h);
                }
            }
        }
    </script>

    <h1>nono-gram Auto Solution</h1>
    <div id="game_table"></div>

    <script>
        makeGameTable();
        root();
    </script>
</body>
</html>